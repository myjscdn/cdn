(window.MIP=window.MIP||[]).push({name:"mip-experiment",func:function(){define("mip-experiment/mip-experiment",["require","customElement","util","templates"],function(t){var e=t("customElement").create(),i=t("util"),n=new i.customStorage(0);e.prototype.initExperiments=function(){var t=this.element,e=t.querySelector('script[type="application/json"][for="mip-experiment"]');if(!e)return void console.warn('<mip-experiment>找不到配置 for="mip-experiment"');var i=e?e.innerHTML:"",n=t.hasAttribute("needConsole"),r="";try{r=JSON.parse(i)}catch(t){return void console.warn("<mip-experiment>配置不是合法JSON, "+t.message)}if(r)for(var a in r){var c=new o(a,r,n,t),s=c.getExpGroup();c.setExpGroup(s),c.bindBaiduStats(c.baiduStats)}};var o=function(t,e,i,n){this.element=n,this.expName=t,this.needConsole=i;var o=e[t];this.expVar=o.variants||{},this.expVar.default=100,this.isSticky=o.hasOwnProperty("sticky")?!!o.sticky:!0,this.descri=o.descri,this.type=o.type,this.baiduStats=o["baidu-stats"]};return o.prototype.getExpGroup=function(){var t=this._getExpGroupFromUrl();if(this.needConsole)if(console.warn("实验名: "+this.expName+", "+this.descri),t)console.warn("URL hash分组生效: "+t);var e="";if(this.isSticky&&!t)if(e=this._getExpGroupFromStorage(),this.needConsole)console.warn("历史分组生效: "+e);if(!e&&!t){var i=this._getExpGroupNew();if(this.needConsole)console.warn("新分组: "+i)}var n=t||e||i;if(this.needConsole)console.warn("最终分组: "+n+"\n\n");return n},o.prototype._getExpGroupFromUrl=function(){var t=window.location.hash.slice(1),e="";if(!t)return"";var i=t.split("&");for(var n in i)if(i[n].match(this.expName+"=")){var o=new RegExp("mip-x-"+this.expName+"=([\\w-_]+)"),r=o.exec(i[n])[1];e=r in this.expVar?r:""}return e},o.prototype._getExpGroupFromStorage=function(){var t=n.get("mip-x-"+this.expName);return t in this.expVar?t:""},o.prototype._getExpGroupNew=function(){for(var t=100*Math.random(),e=Object.keys(this.expVar),i=0;i<e.length-1;i++){var n=this._addVars(i,this.expVar),o=this._addVars(i+1,this.expVar);if(0===i&&t<this.expVar[e[0]])return e[0];if(t>=n&&t<o)return e[i+1];else if(t>o)continue}return"default"},o.prototype._addVars=function(t,e){var i=Object.keys(e);if(0===t)return e[i[0]];else return e[i[t]]+arguments.callee(t-1,e)},o.prototype.setExpGroup=function(e){if(n.set("mip-x-"+this.expName,e),"default"!==e)document.querySelector("body").setAttribute("mip-x-"+this.expName,e);if("tag-abtest"==this.type){var i=t("templates"),o=this.element.querySelector("[for="+this.expName+"]"),r={};r[e]=!0,i.render(o,r,!0).then(function(t){var e=document.createElement("div");e.innerHTML=t.html,o.appendChild(e)})}},o.prototype.bindBaiduStats=function(t){if(t){if(!window._hmt)return void console.warn("<mip-experiment>找不到百度统计，请确认mip-stats-baidu.js在mip-experiment.js之前");for(var e=0;e<t.length;e++){var i={},n=t[e];if(i.ele=n[0]||"",i.event=n[1]||"",i.label=n[2]||"",i.eleDoms=[],"window"===i.ele)i.eleDoms[0]=window;else i.eleDoms=document.querySelectorAll(i.ele);for(var o=0;o<i.eleDoms.length;o++){i.eleDoms[o].addEventListener(i.event,this._sendStats.bind(void 0,i,this.expName),!1)}}}},o.prototype._sendStats=function(t,e){var i="mip-x-"+e,n=document.body.getAttribute(i)||"default";_hmt.push(["_trackEvent",t.ele+"__"+t.event,i+"="+n,t.label])},e.prototype.build=function(){var t=this.element;t.needConsole=t.hasAttribute("needConsole"),this.initExperiments(),i.css(t,"display","inherit")},e}),define("mip-experiment",["mip-experiment/mip-experiment"],function(t){return t}),function(){function t(t,e){t.registerMipElement("mip-experiment",e,"")}if(window.MIP)require(["mip-experiment"],function(e){t(window.MIP,e)});else require(["mip","mip-experiment"],t)}()}});